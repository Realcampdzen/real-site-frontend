# НейроВалюша — план запуска (VK + Telegram + сайт + Путеводитель)

## Цель MVP (Запуск)

1) **VK (группа/сообщество)**  
- Под **каждым новым постом** НейроВалюша автоматически оставляет **уместный комментарий**, понимая тему поста.  
- В обсуждении под постом **отвечает на реплики** (в первую очередь — на ответы ей), держит **контекст последних 10 сообщений**.

2) **Telegram (канал + комментарии)**  
- В комментариях к постам (привязанная группа‑обсуждение) НейроВалюша пишет **первый комментарий** к новым постам и **отвечает** на комментарии в ветке, держит **контекст 10 сообщений**.

3) **Сайт + приложение “Путеводитель”**  
- Сайт уже использует `POST /api/valyusha/chat`.  
- Для “Путеводителя” план: сначала дергать этот же API (Render → CF), позже перенести бэкенд/endpoint на Cloudflare.

## Тон/жанр НейроВалюши (для MVP)

- НейроВалюша — нейро‑ассистент лагеря: **4K‑навыки + вожатское мастерство + ИИ для обучения/творчества (не списывание)**.  
- Комментарии: “умные и живые”, в духе техно/образовательных медиа, лёгкий юмор, **без выдуманных фактов**, без markdown.
- В соцсетях: **уметь отсылаться к значку Путеводителя**, но **упоминать 0–1 значок только когда он реально подходит** к теме поста/ветки (и стараться не повторять один и тот же значок подряд).

## Архитектура (как запускаем)

### Единое ядро (Cloudflare Pages Worker)

Сейчас реализовано в `cf-api/`:
- `POST /api/vk/callback` — VK Callback API
- `POST /api/tg/webhook` — Telegram webhook
- `POST /api/valyusha/chat` — чат для сайта

Хранение контекста:
- KV биндинг `NEUROVALYUSHA_KV` (история последних 10 сообщений на ветку + дедупликация событий)

### VK поток

1) VK присылает событие `wall_post_new` → бот генерит комментарий → `wall.createComment`  
2) VK присылает `wall_reply_new` → бот отвечает, если:
- это ответ на нашу реплику, или
- комментарий содержит вопрос/ключевые слова (анти‑спам фильтр)

### Telegram поток

Канал с комментариями = связанная группа‑обсуждение.

1) В группе появляется **автоматический форвард** поста канала (`is_automatic_forward`) → бот отвечает реплаем на этот форвард (это и есть комментарий к посту)  
2) Пользователь пишет комментарий (как reply) → бот отвечает (приоритетно, если отвечают ему)

## Что нужно от старого репозитория НейроВалюши

Чтобы ускорить запуск и сохранить задумку:
- промпты/персона (system prompt, правила, примеры)
- если был “knowledge base”: файлы про программу лагеря/значки/модули/расписания
- любые наработки по VK Callback / Telegram discussion handling
- список “глюков/мусора”, которые уже выявляли

## Нужные вводные от тебя (коротко)

- VK: `group_id`, хотим комментировать **каждый** пост или только определённые типы?  
- Telegram: ID канала и привязанной группы‑обсуждения, privacy mode (в BotFather) можно выключить?  
- Частота: можно ли отвечать “не на всё”, а только на ответы ей/вопросы (анти‑спам)?

## Дальнейшие улучшения (после MVP)

- Подключить базу знаний (R2/D1) и retrieval по программе лагеря 2026
- Планировщик/“пауза перед ответом” (чтобы выглядело естественно)
- Более умные правила реакции (тон, провокации, хейт, модерация)
- Метрики: сколько постов/комментов, CTR/вовлечённость


